---
title: "análisis inferencial 2022"
author: "Belmonte Valeria"
date: "`r Sys.Date()`"
output:
  word_document: default
  html_document: default
  encoding: "UTF-8"

---
## carga de paquetes
```{r  message=FALSE, , echo=FALSE}
library(tidyverse)
library(viridis)  #Para seleccionar paletas de color
library(ggthemes) #Para elegir temas o plantillas de diseño para tu gráfico
library(hrbrthemes)#Para elegir más temas o plantillas de diseño para tu gráfico
library(flextable)# para dibujar tablas elegantes
library(DT) # para tablas grandes
#Sys.setlocale(category = "LC_ALL", locale = "Spanish")
library(ggthemes) # temas para los fondos de los graficos ggplot
library(paletteer) # para instalar paleta de colores
library(treemap)
options(OutDec = ",")
options(encoding = 'UTF-8')
```
## Borro los datos 
```{r, echo=FALSE}
#limpio la base antes de correr 
rm(list=ls())
```
##cargo los datos con caracteristicas de los estudiantes


La base **ingresantes2023** todos los ingresantes  2022, con los resultados de regualridad en ese año por carrera  

```{r carga de datos, echo=FALSE}
library(readxl)
ingresantes_2022<- read_excel("../datos originales/ingresantes2022_caract_condicion.xlsx",
na = "NA")
```

```{r reordeno los datos, echo=FALSE}
# reacomodo algunas  variables y creo otras

# Crear la nueva variable en el dataframe
ingresantes_2022$Otros_Est_Sup_indicator <- ifelse(is.na(ingresantes_2022$Otros_Est_Sup), 0, 1)
# corrijo Datos_Salud,_Cobertura_Médica
ingresantes_2022=ingresantes_2022 %>%rename("Cobertura_medica"="Datos_Salud,_Cobertura_Médica")
```

```{r veo la estructura de los datos, echo=FALSE}
str(ingresantes_2022)
```

## Resumen de los datos 
```{r, resumen de reincriptos 2023, echo=FALSE}
resumen_reincriptos_23=ingresantes_2022 %>% group_by(reincriptos_23)%>%  summarise(n=n())
resumen_reincriptos_23 %>% flextable()
```

En  función de En la regla de "eventos por variable predictora" (EPV)  
tenemos = n(1)/ v. predictoras= 10; entonces;  114/5= v predictoras daría 11 variables predicotoras
además  n(0)=125/v predictoras = 10 -> 12 variables predictoras 

por lo tanto no está muy desbalanceados 



```{r, echo=FALSE,eval=FALSE}
#library(glm)
# Ajustar el modelo de regresión logística
# modelo 1  tiene 12 varibles 
m1<- glm(reincriptos_23 ~
           Carrera+
           Estado_Civil+
           Genero+
           Situacion_Ocupacional_Alumno+
           as.factor(Otros_Est_Sup_indicator) +
           Porc_Regularizadas+
           edad+
           as.factor(asitio_alguna_materia )+
           Cobertura_medica+
           Estudios_Madre+
           Estudios_Padre+
           Año_Egreso,
data = ingresantes_2022,
family = binomial)
# Resumen del modelo
summary(m1)
```
## Voy a hacer ua selección de modelo
```{r seleccion del modelo}
step(m1,direction = "both")
```

```{r}
m2=glm(formula = reincriptos_23 ~ 
         Carrera + 
         Estado_Civil +
         Genero + 
    Situacion_Ocupacional_Alumno +
      Porc_Regularizadas +
      edad + 
    as.factor(asitio_alguna_materia) +
      Cobertura_medica + Estudios_Madre + 
    Estudios_Padre +
      Año_Egreso,
    family = binomial, data = ingresantes_2022)
step(m2,direction="backward")
```
```{r}
summary(m2)
```

```{r}
#elimine asisitio a alguna materia
m3=glm(formula = reincriptos_23 ~
         Carrera + 
         Estado_Civil +
         Genero + 
    Situacion_Ocupacional_Alumno +
      Porc_Regularizadas +
      edad +
      Cobertura_medica +
      Estudios_Madre + 
    Estudios_Padre +
      Año_Egreso,
    family = binomial, data = ingresantes_2022)
summary(m3)
```

```{r}
# Eliminar filas con NA en las variables usadas en el modelo
ingresantes_2022_clean <- na.omit(ingresantes_2022[, c("reincriptos_23", "Carrera", "Genero", "Estado_Civil","Cost_est__aporte_familiar", "Situacion_Ocupacional_Alumno" , "Porc_Regularizadas", "edad", "Estudios_Madre", "Estudios_Padre")])
nrow(ingresantes_2022_clean)
nrow(ingresantes_2022)


```

```{r}
str(ingresantes_2022_clean)
```




Hay un estudiante de IA que no informa el estado civil
Cuantos no  informan el año de egreso: 41,donde   27 son de IA, 14   de LANA 
No se puede incluir en el modelo
Cuantos no informan  cobertura medica: 59  , 19 IA, 28 de LANA, y 12 de TPVI

una  variable que conserva 224 estudiantes es "Tiene_beca?" que podría tambien probar si puede agregarse.


## Corro el  modelo con las varaibles que tienen información de todos los estudiantes


```{r}
# Ajustar el modelo sin valores faltantes
m4 <- glm(reincriptos_23 ~ 
            Carrera +
            Genero +
            Estado_Civil+
            Cost_est__aporte_familiar+
            Situacion_Ocupacional_Alumno+
            Porc_Regularizadas + 
            edad +
            Estudios_Madre + 
            Estudios_Padre ,
          data = ingresantes_2022_clean, family = binomial)
```
```{r}
summary(m4)
```
```{r}
step(m4)
```

```{r}
# Ajustar el modelo sin valores faltantes
m5 <- glm(reincriptos_23 ~ 
            Carrera +
            Genero +
            Cost_est__aporte_familiar+
            Porc_Regularizadas 
           ,
          data = ingresantes_2022_clean, family = binomial)
```


```{r}
summary(m5)
```
```{r}
# Ajustar el modelo sin valores faltantes
m6 <- glm(reincriptos_23 ~ 
            Carrera +
            Cost_est__aporte_familiar+
            Porc_Regularizadas 
           ,
          data = ingresantes_2022_clean, family = binomial)
summary(m6)
```

